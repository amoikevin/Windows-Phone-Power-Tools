<Window x:Class="WindowsPhonePowerTools.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:this="clr-namespace:WindowsPhonePowerTools"
        xmlns:metro="clr-namespace:MetroUI;assembly=MetroUI"
        Title="Windows Phone Toolbox" Height="378" Width="535" ResizeMode="NoResize" WindowStyle="None"
        Icon="wptools.ico"
        SourceInitialized="Window_SourceInitialized"
        Background="White">

    <Window.Resources>
        <this:FileTypeToIconConverter x:Key="FileTypeToIconConverter"></this:FileTypeToIconConverter>
        <this:StreamToBitmapImageConverter x:Key="StreamToBitmapImageConverter"></this:StreamToBitmapImageConverter>
        <this:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"></this:BoolToVisibilityConverter>

        <Style x:Key="DeviceInfoHeader" TargetType="TextBlock">
            <Setter Property="Margin" Value="0,0,12,0"></Setter>
        </Style>

        <DataTemplate x:Key="ItemTemplate">
            <TextBlock Text="{Binding}" Foreground="Red" />
        </DataTemplate>

        <DataTemplate x:Key="SelectedTemplate">
            <TextBlock Text="{Binding}" Foreground="White" />
        </DataTemplate>

        <Style TargetType="Button" x:Key="ConnectionIndicatorStyle">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel Margin="0,5,0,0" Visibility="{Binding Device.Connected, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}">
                                <TextBlock FontFamily="Segoe WP" FontWeight="Bold" HorizontalAlignment="Right">NO DEVICE</TextBlock>
                                <TextBlock FontFamily="Segoe WP" FontWeight="Bold" FontSize="8" HorizontalAlignment="Right">CLICK TO CONNECT</TextBlock>
                            </StackPanel>
                            <StackPanel Margin="0,5,0,0" Visibility="{Binding Device.Connected, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock HorizontalAlignment="Right" FontFamily="Segoe WP" FontWeight="Bold" Text="{Binding Device.CurrentDevice.Name}"></TextBlock>
                                <TextBlock HorizontalAlignment="Right" FontFamily="Segoe WP" FontWeight="Bold" Text="{Binding Device.DeviceType}"></TextBlock>
                            </StackPanel>
                            <Canvas Margin="6,0,0,0" Width="36" Height="36">
                                <Rectangle Height="36" Width="36" Fill="{Binding StatusColor}"></Rectangle>
                                <Image Source="/images/phone_logo.png" Height="30" Width="18" Canvas.Left="9" Canvas.Top="3"></Image>
                                <Rectangle Height="36" Width="36" x:Name="rectStatusHighlight" Visibility="Collapsed">
                                    <Rectangle.Fill>
                                        <SolidColorBrush Color="Gray" Opacity="0.4"></SolidColorBrush>
                                    </Rectangle.Fill>
                                </Rectangle>
                            </Canvas>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#a9a9a9"></Setter>
                                <Setter TargetName="rectStatusHighlight" Property="Visibility" Value="Visible"></Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ListBoxItem" x:Key="PivotHeaders">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <TextBlock Name="TextBlock" Text="{TemplateBinding Content}" Foreground="LightGray" FontFamily="Segoe WP" FontSize="25" Margin="0,0,20,0" FontWeight="Thin"></TextBlock>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="TextBlock" Property="Foreground" Value="Gray"/>
                            </Trigger>

                            <Trigger Property="IsSelected" Value="true">
                                <Setter TargetName="TextBlock" Property="Foreground" Value="Black"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Grid>

        <Grid.ColumnDefinitions>
            <ColumnDefinition></ColumnDefinition>
            <ColumnDefinition></ColumnDefinition>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="36"></RowDefinition>
            <!-- Zune Metro has 36px on the upper bar -->
            <RowDefinition Height="36"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
        </Grid.RowDefinitions>

        <Rectangle Fill="White" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="0" PreviewMouseDown="Rectangle_PreviewMouseDown"></Rectangle>

        <StackPanel Orientation="Horizontal" Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right" Margin="0,0,12,0" VerticalAlignment="Top">
            <Grid Margin="0,0,18,0" x:Name="gridConnectionIndicator">
                <Button Name="btnIndicator" Click="btnIndicator_Click" Style="{StaticResource ConnectionIndicatorStyle}">
                </Button>
            </Grid>
            <this:ImageButton Image="/images/exit.png" HoverImage="/images/exit_highlighted.png" Height="8" Width="8" x:Name="btnClose" Click="btnClose_Click"/>
        </StackPanel>

        <ListBox Grid.Row="1" Grid.ColumnSpan="2" ItemContainerStyle="{StaticResource PivotHeaders}" BorderThickness="0" Margin="12,0,0,0">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal"></StackPanel>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>

            <ListBoxItem x:Name="headerInstall" Selected="headerInstall_Selected">install|update</ListBoxItem>
            <ListBoxItem x:Name="headerApps" Selected="headerApps_Selected">apps</ListBoxItem>
            <ListBoxItem x:Name="headerFileBrowser" Selected="headerFileBrowser_Selected">file browser</ListBoxItem>
        </ListBox>

        <Canvas Grid.Row="2" Grid.ColumnSpan="2">
            <Canvas x:Name="pivotInstall" IsEnabled="{Binding Device.Connected}" Visibility="Collapsed">
                <Grid>
                    <TextBox Height="22" HorizontalAlignment="Left" Margin="8,35,0,0" Name="txtXapFile" VerticalAlignment="Top" Width="364" />
                    <Button Content="Browse" Height="24" HorizontalAlignment="Left" Margin="378,35,0,0" Name="btnBrowse" VerticalAlignment="Top" Width="77" Click="btnBrowse_Click" />
                    <Button Content="Install" Height="24" HorizontalAlignment="Left" Margin="8,63,0,0" Name="btnInstall" VerticalAlignment="Top" Width="77" Click="btnInstall_Click" />
                    <Button Content="Update" Height="24" HorizontalAlignment="Left" Margin="104,63,0,0" Name="btnUpdate" VerticalAlignment="Top" Width="77" Click="btnUpdate_Click" />
                    <TextBlock Height="23" HorizontalAlignment="Left" Margin="8,15,0,0" Name="textBlock1" VerticalAlignment="Top" Width="340">XAP Path (separate multiple files with a semi-colon (;)s):</TextBlock>
                    <TextBlock Height="81" HorizontalAlignment="Left" Margin="8,97,0,0" Name="textBlock2" TextWrapping="Wrap" VerticalAlignment="Top" Width="488">
                        &#8226; Failures are silent - Updating a xap that is not already installed will have no effect<LineBreak/>
                        &#8226; Installing a xap that already exists will wipe the existing installation and reinstall the xap
                    </TextBlock>
                </Grid>
            </Canvas>
            <Canvas x:Name="pivotApps" IsEnabled="{Binding Device.Connected}" Visibility="Collapsed">
                <Canvas>
                    <TextBlock Margin="6,11,349,243">Installed Apps</TextBlock>
                    <ListBox Height="233" HorizontalAlignment="Left" Margin="6,32,0,0" Name="lstInstalledApps" VerticalAlignment="Top" Width="242" ItemsSource="{Binding Device.InstalledApplications}" SelectedItem="{Binding CurSelectedInstalledApp, Mode=TwoWay}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                                    <Image Height="20" Width="20" Margin="0,0,4,0" Source="{Binding Icon, Converter={StaticResource StreamToBitmapImageConverter}}"></Image>
                                    <TextBlock Text="{Binding Name}"></TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <GroupBox Canvas.Left="254" Canvas.Top="203" Header="Actions" Height="62" Width="246">
                        <Canvas>
                            <Button Content="Uninstall" Height="23" Name="btnUninstall" Width="65" Click="btnUninstall_Click" Canvas.Left="7" Canvas.Top="6" />
                            <Button Content="Launch" Height="23" x:Name="btnLaunchApp" Click="btnLaunchApp_Click" Canvas.Left="89" Canvas.Top="6" Width="60"></Button>
                            <Button Content="Kill" Height="23" x:Name="btnKillApp" Click="btnKillApp_Click" Canvas.Left="164" Canvas.Top="6" Width="60"></Button>
                        </Canvas>
                    </GroupBox>
                    <Grid Canvas.Left="274" Canvas.Top="114" />
                    <GroupBox Canvas.Left="254" Canvas.Top="15" Header="Properties" Height="188" Name="groupBox2" Width="246" DataContext="{Binding CurSelectedInstalledApp}">
                        <StackPanel Margin="3,0,0,0">
                            <TextBlock Height="20" Text="Guid:" />
                            <TextBlock Height="22" Name="txtAppGuid" Width="232" Text="{Binding RemoteApplication.ProductID}" />
                        </StackPanel>
                    </GroupBox>
                </Canvas>
            </Canvas>
            <Canvas x:Name="pivotFileBrowser" IsEnabled="{Binding Device.Connected}" Visibility="Visible">
                <Canvas>
                    <TreeView Height="209" Width="391" x:Name="treeIsoStore" SelectedItemChanged="treeIsoStore_SelectedItemChanged" ItemsSource="{Binding Device.RemoteIsoStores}" TreeViewItem.Expanded="treeIsoStore_Expanded">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="{x:Type TreeViewItem}">
                                <EventSetter Event="MouseDoubleClick" Handler="treeIsoStore_OnDoubleClick"></EventSetter>
                            </Style>
                        </TreeView.ItemContainerStyle>
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal">
                                    <Image Height="16" Width="16" Source="{Binding Icon, Converter={StaticResource FileTypeToIconConverter}}" Margin="0,1,5,3"></Image>
                                    <TextBlock Text="{Binding Name}"></TextBlock>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                        <TreeView.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Refresh" x:Name="btnRefresh" Click="btnRefresh_Click" />
                                </ContextMenu>
                        </TreeView.ContextMenu>
                    </TreeView>
                    <Button Canvas.Left="7" Canvas.Top="215" Content="Get" Height="24" Name="btnGet" Width="77" Click="btnGet_Click" />
                    <Button Canvas.Left="108" Canvas.Top="215" Content="Put File" Height="24" Name="btnPutFile" Width="77" Click="btnPutFile_Click" />
                    <Button Canvas.Left="204" Canvas.Top="215" Content="Put Directory" Height="24" Name="btnPutDirectory" Width="92" Click="btnPutDirectory_Click" />
                    <Button Canvas.Left="314" Canvas.Top="215" Content="Delete" Height="24" Name="btnDelete" Width="77" Click="btnDelete_Click" />
                    <CheckBox Canvas.Left="7" Canvas.Top="245" Content="Overwrite Existing" Height="16" Name="chkOverwrite" />
                    <StackPanel x:Name="stackFileProperties" Canvas.Left="397" Canvas.Top="-1" Width="130">
                        <TextBlock Height="19" Text="CREATED" FontWeight="Bold" FontSize="10" />
                        <TextBlock Height="23" Text="{Binding CreationTime}" />
                        <TextBlock Height="19" Text="ATTRIBUTES"  FontWeight="Bold" FontSize="10"/>
                        <TextBlock Height="23" Text="{Binding FileAttribute}" />
                        <TextBlock Height="19" Text="LAST ACCESSED"  FontWeight="Bold" FontSize="10"/>
                        <TextBlock Height="23" Text="{Binding LastWriteTime}" />
                        <TextBlock Height="19" Text="LAST WRITE"  FontWeight="Bold" FontSize="10"/>
                        <TextBlock Height="23" Text="{Binding LastAccessTime}" />
                        <TextBlock Height="19" Text="SIZE"  FontWeight="Bold" FontSize="10"/>
                        <TextBlock Height="23" Text="{Binding Length}" />
                    </StackPanel>
                </Canvas>
            </Canvas>
        </Canvas>

        <metro:MetroDialog x:Name="dialogConnect" Visibility="Collapsed" Grid.ColumnSpan="2" Grid.RowSpan="3" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" DataContext="{Binding Device}">
            <Canvas>
                <TextBlock Margin="23,30,428,0" Height="18" VerticalAlignment="Top" Canvas.Left="-5">Connect to:</TextBlock>
                <ComboBox Canvas.Left="85" Canvas.Top="28" ItemsSource="{Binding Devices}" SelectedItem="{Binding CurrentDevice, Mode=TwoWay}" HorizontalAlignment="Right" Width="293">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"></TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap" Foreground="Red" Visibility="{Binding Connected, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" Height="25" Width="282" Canvas.Left="18" Canvas.Top="53"></TextBlock>
                <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap" Foreground="Green" Height="25" Width="282" Canvas.Left="18" Canvas.Top="53" Visibility="{Binding Connected, Converter={StaticResource BoolToVisibilityConverter}}"></TextBlock>
                <Button x:Name="btnConnect" Content="CONNECT" Click="btnConnect_Click" Height="22" Width="73" FontFamily="Segoe WP" Canvas.Left="306" Canvas.Top="53"></Button>

                <Expander Height="165 " Header="DEVICE INFORMATION" FontWeight="Bold" HorizontalAlignment="Left" Canvas.Top="78" Canvas.Left="19">
                    <ScrollViewer Height="135" Width="352" FontWeight="Regular" Margin="0,6,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Platform" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="OS Version Major" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="OS Version Major" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="OS Build No" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Architecture" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Instruction Set" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Processors" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Device Time" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Default Locale" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Available Memory" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Available Virtual" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Page Size" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Page File Size" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Total Memory" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Total Virtual" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Charging" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Full Battery Lifetime" />
                                <TextBlock Style="{StaticResource DeviceInfoHeader}" Text="Battery %" />
                            </StackPanel>
                            <StackPanel Grid.Column="1">
                                <TextBlock Height="18" Text="{Binding CurrentDevice.Platform.Name}" VerticalAlignment="Top" />
                                <TextBlock Text="{Binding SystemInfo.OSBuildNo}" />
                                <TextBlock Text="{Binding SystemInfo.OSMajor}" />
                                <TextBlock Text="{Binding SystemInfo.OSMinor}" />
                                <TextBlock Text="{Binding SystemInfo.ProcessorArchitecture}" />
                                <TextBlock Text="{Binding SystemInfo.InstructionSet}" />
                                <TextBlock Text="{Binding SystemInfo.NumberOfProcessors}" />
                                <TextBlock Text="{Binding SystemInfo.CurrentTime}" />
                                <TextBlock Text="{Binding SystemInfo.SystemDefaultLocaleId}" />
                                <TextBlock Text="{Binding SystemInfo.AvailPhys}" />
                                <TextBlock Text="{Binding SystemInfo.AvailVirtual}" />
                                <TextBlock Text="{Binding SystemInfo.PageSize}" />
                                <TextBlock Text="{Binding SystemInfo.TotalPageFile}" />
                                <TextBlock Text="{Binding SystemInfo.TotalPhys}" />
                                <TextBlock Text="{Binding SystemInfo.TotalVirtual}" />
                                <TextBlock Text="{Binding SystemInfo.ACLineStatus}" />
                                <TextBlock Text="{Binding SystemInfo.BatteryFullLifetime}" />
                                <TextBlock Text="{Binding SystemInfo.BatteryLifePercent}" />
                            </StackPanel>
                        </Grid>
                    </ScrollViewer>
                </Expander>
            </Canvas>
        </metro:MetroDialog>
    </Grid>
</Window>
